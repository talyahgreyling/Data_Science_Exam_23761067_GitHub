---
title: "Streaming Service Success: an Analysis on Netflix Data"
author: "Talyah Greyling"
date: "`r Sys.Date()`"
bibliography: Tex/ref.bib       
output:
  pagedown::html_paged:
    # template: wp_paged.html
    # css: ['wp.css', 'wp-fonts.css', 'wp-page.css']
    css: ["Template/default-fonts-Texevier.css", "Template/default-page-Texevier.css", "Template/default-Texevier.css"]
    csl: Template/harvard-stellenbosch-university.csl # referencing format used.
    template: ["Template/paged-Texevier.html"]

    toc: false
    # change to true for a self-contained document, but it'll be a litte slower for Pandoc to render
    self_contained: TRUE
    
abstract: |
    This html document contains an analysis of Netflix data to uncover the dos and don'ts of streaming services. Key statistics, graphs and tables are accompanied by short summaries ideal for any busy investor to make quick & efficient investment calls. 

---

```{r setup, include = FALSE}

# Housekeeping 
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, fig.width = 6, fig.height = 5, fig.pos = 'H') # set chunk defaults 
rm(list = ls()) # clear environment 
gc() # garbage collection
options(scipen = 999) #suppress scientific notation
options(dplyr.summarise.inform=F) # suppress messages 

# Load neccessary libraries 
pacman::p_load(dplyr, ggplot2, tidyverse, stringr, purrr, lubridate, gt, fmsb, hrbrthemes) ############## update 

# Source all existing functions 
list.files('..//Question1/code/', full.names = T, recursive = T) %>% as.list() %>% walk(~source(.))
list.files('..//Question2/code/', full.names = T, recursive = T) %>% as.list() %>% walk(~source(.))
list.files('code/', full.names = T, recursive = T) %>% as.list() %>% walk(~source(.))

# Set theme & colour palette
palette <- c("#3A7370", "#FB9072", "#FFC57B", "#CE677A", "#163940", "#2C1F2C")
theme <- set_custom_theme()

# Load data 
location <- "data/netflix/"
df_titles <- read_rds(glue::glue("{location}titles.rds"))
df_credits <- read_rds(glue::glue("{location}credits.rds"))
df_movies <-  read_csv(glue::glue("{location}netflix_movies.csv"))

```

\newpage 
# Introduction
Recent declines in Netflix subscribers and stock value may be signaling shifting industry dynamics. Typically drama, comedy, and action genres drive the highest viewer engagement [@ContentEngine2023], offering critical insights for new streaming platforms. This analysis summarises key trends in successful content strategies to guide potential investors in the competitive streaming market.

```{r genre plot wrangling}

# Prepare data for genre plot
df_titles <- add_main_genre(df_titles)

# Generate genre distribution
genre_distribution <- df_titles %>%
    group_by(main_genre) %>%
    summarise(count = n()) %>%
    arrange(desc(count)) %>%
    filter(main_genre != "")

# Calculate top 10 genres by average audience score
top_10_genres <- df_titles %>%
    group_by(main_genre) %>%
    summarise(ave_score = mean(imdb_score, na.rm = TRUE)) %>%
    arrange(desc(ave_score)) %>%
    mutate(main_genre = factor(main_genre, levels = main_genre)) %>% 
    head(10)

```

```{r genre}
# Plot genre distribution
ggplot(genre_distribution, aes(x = main_genre, y = count)) +
  geom_col(fill = "#a60c28") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme +
  labs(x = "Main Genre", y = "Number of Movies", title = "Distribution of Genres on Netflix")

# Plot top 10 genres by average audience score
ggplot(top_10_genres, aes(x = main_genre, y = ave_score)) +
  geom_bar(stat = "identity", fill = "#a60c28") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme +
  labs(x = "Main Genre", y = "Average Audience Score", title = "Top 10 genres by Average Audience Score")

# plot1 <- plot_top_10(data = top_10_genres, focus_col = main_genre, choose_colour = "#a60c28", x_label = "Main Genre", y_label = "Average Audience Score",title_label = "Top 10 genres by Average Audience Score")
# plot1
```

```{r }

# Create duration data frame
df_duration <- left_join(df_titles, df_movies, by = "title") %>% 
    filter(!is.na(imdb_score)) %>%
    mutate(minutes = sub(" min", "", duration))

# Generate duration distribution
duration_distribution <- df_duration %>%
    group_by(minutes) %>%
    summarise(count = n()) %>%
    arrange(desc(count)) %>% 
    filter(!is.na(minutes)) %>% 
    mutate(minute_bin = floor(as.numeric(minutes) / 10) * 10) %>%
    group_by(minute_bin) %>%
    summarise(total_count = sum(count)) %>%             
    arrange(minute_bin) 

# Calculate top 10 durations by average audience score
top_10_durations <- df_duration %>%
    group_by(minutes) %>%
    summarise(ave_score = mean(imdb_score, na.rm = TRUE)) %>%
    arrange(desc(ave_score)) %>%
    mutate(minutes = factor(minutes, levels = minutes)) %>% 
    head(10)

```

```{r duration}
# Plot duration distribution
ggplot(duration_distribution, aes(x = minute_bin, y = total_count)) +
  geom_col(fill = "#0b2585") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme +
  labs(x = "Duration (in minutes)", y = "Number of Movies", title = "Distribution of durations on Netflix")

# Plot top 10 durations by average audience score
ggplot(top_10_durations, aes(x = minutes, y = ave_score)) +
  geom_bar(stat = "identity", fill = "#0b2585") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme +
  labs(x = "Duration (in minutes)", y = "Average Audience Score", title = "Top 10 durations by Average Audience Score")
```

\newpage 
# References
